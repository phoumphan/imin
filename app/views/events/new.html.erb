<% content_for :head do %>
  <%= javascript_include_tag 'jquery.tokeninput' %>
  <%= stylesheet_link_tag 'token-input'  %>
<script src="http://maps.google.com/maps?file=api&v=2&key=abcdefg&sensor=false"
        type="text/javascript">
</script>
<script src="http://gmaps-utility-library.googlecode.com/svn/trunk/markermanager/release/src/markermanager.js"
        type="text/javascript">
</script>
<script src="/javascripts/MapCommon.js"
        type="text/javascript">
</script>
<script type="text/javascript">
<!--
var marker = null;

function placemarker(overlay, latlng, overlaylatlng) {
  if (!marker) {
    marker = new GMarker(latlng, { draggable: true });
    map.addOverlay(marker);
  } else {
    marker.setLatLng(latlng);
  }
}

function initialize() {
  basic_init();

  GEvent.addListener(map, "click", placemarker);

  //Put back marker that was already in the model
  if (location.value != "") {
    latlng = location.split(',');
    marker = new GMarker(new GLatLng(latlng[0], latlng[1]));
    map.addOverlay(marker);
  }
}

function submitForm() {
  var i;

  if (marker) {
    document.getElementById('event_location').value = marker.getLatLng().lat() + ',' + marker.getLatLng().lng();

    inv = document.form.invited.options[0].text;
    for (i=1;i<document.form.invited.options.length;i++) {
      inv += "," + document.form.invited.options[i].text;
    }
    document.form.user_events.value = inv;

    document.form.submit();
  } else {
    alert("Please place the location on the map.");
  }
}

function addInvitee() {
  //Based on http://www.plus2net.com/javascript_tutorial/list-adding.php
  var optn = document.createElement("OPTION");
  if (document.form.friend[0].checked) {
    optn.text = document.form.friends.options[document.form.friends.selectedIndex].text;
  } else {
    optn.text = document.form.other_user.value;
  }
  //option values are never used
  document.form.invited.add(optn);
}

function removeInvitee() {
  document.form.invited.remove(document.form.invited.selectedIndex);
}

//-->
</script>
<% end %>

<% content_for :body_attributes do %>
onLoad="initialize();"
onUnload="GUnload();"
<% end %>

<div id="user_nav">
        <%if current_user%>
          <%=link_to 'Profile', {:controller => 'users', :action => 'profile'}, :class => 'user_nav_link'%>
          <%=link_to 'Create Event', {:controller => 'events', :action => 'new'}, :class => 'user_nav_link_on'%>
          <%=link_to 'My Preferences', {:controller => 'users', :action => 'preferences'}, :class => 'user_nav_link'%>
          <%=link_to 'Friends', {:controller => 'friendships', :action => 'display'}, :class => 'user_nav_link'%>
           <%=link_to 'Edit', {:controller => 'users', :action => 'edit_info'}, :class => 'user_nav_link'%>
      <%end%>
</div>
<div class="user_profile_container">
  <div class="user_profile">
    <div id="wrapper">
<%form_for @event, :action => 'create', :html => { :multipart => true, :name => "form" } do |f|%>
  <%=f.error_messages%>
  <table id="event_table">
  <tr>
    <td>Event Name:</td>
    <td><%=f.text_field :name%></td>
  </tr>

  <tr><td>Event Description:</td>
  <td><%=f.text_area :description, :style => 'height:60px'%></td></tr>


  <tr><td><%=f.label :start_at, 'Event Starts At:'%></td>
  <td><%= f.text_field :start_at %></td></tr>

  <tr><td><%=f.label :end_at, 'Event Ends At:  '%></td>
  <td><%=f.text_field :end_at%></td></tr>

 
  <tr>
    <td>Location:</td>
    <td><div id="map_canvas" style="width: 500px; height: 300px; padding: 0; margin: 0; margin-bottom: 15px;"></div></td>
  </tr>

  <tr><td>Dress Code:</td>
  <td><%=f.select :formality, ['Formal', 'Dressy', 'Dressy-Casual', 'Casual']%></td></tr>

  <tr><td>Price:</td><td>
  <%=f.text_field :cost, :size => 10%> &nbsp; Dollars</td></tr>

  <tr><td>Event Privacy:</td>
  <td><%=f.select :public, ['Private', 'Public']%></td></tr>
  
  </table>

  <div id='eventtypes'>
  </div>
  <%=link_to_remote 'Add an Event Tag', :url => {:action => 'add_eventtype'}%>
  <br /><br />

  <table>
  <tr><td><h3>Invite a Friend</h3></td></tr>

  <tr><td><%=radio_button_tag :friend, '1', :checked => true%> Friend:</td></tr>

  <tr><td><%=select_tag :friends, options_for_select(@friends)%></td></tr>

  <tr><td><br><%=radio_button_tag :friend, '0' %> Other user:</td></tr>

  <tr><td><%=text_field_tag :other_user%></td></tr>

  <tr><td><input type="button" value="Add" onclick="addInvitee();" /></td></tr>

  <tr><td>
  <hr />
  Invited:<br />
  <%= select_tag "invited", (@invited.split(',').map {|nm| "<option>" + nm + "</option>" }).join(""), :multiple => true, :style => 'width: 100px' %>
  </td></tr>

  <tr><td><input type="button" value="Remove" onclick="removeInvitee();" /></td></tr>
  </table>

  <hr />
  
  <%=f.hidden_field :location%>

  <%=hidden_field_tag :user_events%>

  <input type="button" value="Create Event" onclick="submitForm();" />
<%end%>
    </div>
    </div>
  </div>

